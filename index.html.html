<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meeting 41 CE&STT - Quest</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        :root {
            --navy-blue: #001a33; 
            --gold-accent: #d4af37; 
            --success-color: #28a745;
            --orange-theme: #f39c12;
            --danger-red: #dc3545;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--navy-blue);
            margin: 0; padding: 10px;
            display: flex; justify-content: center; min-height: 100vh;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            padding: 25px; border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            width: 100%; max-width: 480px; text-align: center;
            border: 3px solid var(--gold-accent);
            height: fit-content; margin-top: 20px;
        }

        .header-section { margin-bottom: 20px; }
        .main-title { font-size: 2rem; font-weight: 800; color: var(--gold-accent); margin: 0; line-height: 1.2; }

        input[type="text"], input[type="tel"], textarea {
            width: 90%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 2px solid #ddd; font-family: 'Kanit'; font-size: 1rem;
        }

        button { padding: 12px 20px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--navy-blue); color: white; width: 95%; font-size: 1.1rem; border: 1px solid var(--gold-accent); }
        .btn-add { background: var(--orange-theme); color: white; width: 100%; font-size: 1.1rem; margin-top: 10px; }
        .btn-save { background: var(--success-color); color: white; width: 100%; margin-top: 10px; }

        .list-item {
            background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 15px;
            text-align: left; border-left: 6px solid var(--orange-theme); box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á Admin User Card ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° */
        .admin-user-card {
            background: white; padding: 15px; margin: 10px 0; border-radius: 15px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #ddd;
        }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000; padding: 10px;
        }

        .admin-del-btn { background: var(--danger-red); color: white; padding: 5px 10px; border-radius: 8px; font-size: 0.7rem; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h1 class="main-title">CE&STT QUEST</h1>
        <p style="color: var(--navy-blue); font-weight: bold;">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà</p>
    </div>

    <hr style="border:0; border-top:2px solid var(--gold-accent); margin: 15px 0;">

    <div id="login-section">
        <input type="text" id="login-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        <input type="text" id="login-batch" placeholder="‡∏£‡∏∏‡πà‡∏ô (‡πÄ‡∏ä‡πà‡∏ô CE20)">
        <button class="btn-main" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div id="user-section" style="display: none;">
        <h3 style="margin:0; color:var(--navy-blue)">‡∏Ñ‡∏∏‡∏ì: <span id="display-name" style="color:var(--orange-theme)"></span></h3>
        <div id="senior-list" style="margin-top: 15px;"></div>
        <button id="add-button" class="btn-add" onclick="showForm()">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà <span id="next-num">1</span></button>
        <button onclick="location.reload()" style="background:#ccc; margin-top:15px; font-size:0.8rem;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div id="admin-section" style="display: none;">
        <h2 style="color:var(--navy-blue)">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Admin</h2>
        <div id="all-users-list"></div>
        <button onclick="location.reload()" style="background:#666; color:white; margin-top:20px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
</div>

<div id="formModal" class="modal">
    <div style="background:white; padding:20px; border-radius:20px; width:100%; max-width:400px; max-height: 90vh; overflow-y: auto;">
        <h3 id="form-title" style="color:var(--navy-blue); margin-top:0;">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà</h3>
        <input type="text" id="s-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà">
        <input type="text" id="s-nickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
        <input type="text" id="s-batch" placeholder="‡∏£‡∏∏‡πà‡∏ô CE-STT">
        <input type="tel" id="s-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
        <input type="text" id="s-work" placeholder="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">
        <textarea id="s-intern" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô" rows="3"></textarea>
        <button id="save-btn" class="btn-save" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button onclick="closeForm()" style="background:#ccc; width:100%; margin-top:8px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<div id="adminDetailModal" class="modal">
    <div style="background:white; padding:20px; border-radius:20px; width:100%; max-width:400px; max-height: 80vh; overflow-y: auto; text-align: left;">
        <h3 id="admin-view-title" style="color:var(--navy-blue); margin-top:0;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
        <div id="admin-view-content"></div>
        <button onclick="closeAdminModal()" style="background:var(--navy-blue); color:white; width:100%; margin-top:15px;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAId-pF0U0hUe6hOxBf5SZu4sBObk2FIIc",
        authDomain: "binggocivil.firebaseapp.com",
        databaseURL: "https://binggocivil-default-rtdb.firebaseio.com",
        projectId: "binggocivil",
        storageBucket: "binggocivil.firebasestorage.app",
        messagingSenderId: "615822572602",
        appId: "1:615822572602:web:5207b9a09174d41daf0903"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let currentUser = "";
    let currentBatch = "";
    let mySeniors = [];

    function login() {
        const nameInput = document.getElementById('login-name').value.trim();
        const batchInput = document.getElementById('login-batch').value.trim();
        if (!nameInput) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠!");
        if (nameInput === "meeting41civil") {
            showAdmin();
        } else {
            if (!batchInput) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏∏‡πà‡∏ô!");
            currentUser = nameInput;
            currentBatch = batchInput;
            loadUserData();
        }
    }

    function loadUserData() {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('user-section').style.display = 'block';
        document.getElementById('display-name').innerText = currentUser + " (‡∏£‡∏∏‡πà‡∏ô " + currentBatch + ")";
        db.ref('users/' + currentUser).on('value', (snapshot) => {
            const data = snapshot.val();
            mySeniors = (data && data.seniors) ? data.seniors : [];
            renderList();
        });
    }

    function renderList() {
        const listDiv = document.getElementById('senior-list');
        listDiv.innerHTML = "";
        mySeniors.forEach((s, index) => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <div style="font-size:0.9rem; color:var(--orange-theme); font-weight:bold;">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${index+1}</div>
                <div style="font-size:1.1rem; font-weight:800; color:var(--navy-blue);">${s.name} (${s.nickname})</div>
                <div style="font-size:0.85rem; color:#666; margin-top:5px;">
                    ‡∏£‡∏∏‡πà‡∏ô: CE${s.batch} | ‡πÇ‡∏ó‡∏£: ${s.phone}<br>
                    ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: ${s.work}
                </div>
            `;
            listDiv.appendChild(item);
        });
        document.getElementById('next-num').innerText = mySeniors.length + 1;
    }

    function showForm() { document.getElementById('formModal').style.display = 'flex'; }
    function closeForm() { document.getElementById('formModal').style.display = 'none'; }
    function closeAdminModal() { document.getElementById('adminDetailModal').style.display = 'none'; }

    function saveData() {
        const sName = document.getElementById('s-name').value.trim();
        const sNickname = document.getElementById('s-nickname').value.trim();
        const sBatch = document.getElementById('s-batch').value.trim();
        const sPhone = document.getElementById('s-phone').value.trim();
        const sWork = document.getElementById('s-work').value.trim();
        const sIntern = document.getElementById('s-intern').value.trim();

        if(!sName) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà");
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

        const newSenior = {
            name: sName,
            nickname: sNickname || "-",
            batch: sBatch || "-",
            phone: sPhone || "-",
            work: sWork || "-",
            intern: sIntern || "-"
        };

        const updatedSeniors = [...mySeniors, newSenior];

        db.ref('users/' + currentUser).set({
            name: currentUser,
            batch: currentBatch,
            seniors: updatedSeniors,
            count: updatedSeniors.length
        }).then(() => {
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            closeForm();
            document.querySelectorAll('#formModal input, #formModal textarea').forEach(el => el.value = "");
            btn.disabled = false;
            btn.innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        });
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Admin ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö ---

    function showAdmin() {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('admin-section').style.display = 'block';

        db.ref('users').on('value', (snapshot) => {
            const listDiv = document.getElementById('all-users-list');
            listDiv.innerHTML = "";
            if(!snapshot.exists()) return listDiv.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p>";
            
            snapshot.forEach((child) => {
                const user = child.val();
                const card = document.createElement('div');
                card.className = 'admin-user-card';
                card.innerHTML = `
                    <div style="text-align:left">
                        <b style="color:var(--navy-blue)">${user.name} (CE${user.batch})</b><br>
                        <small style="color:var(--success-color)">‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ: ${user.count || 0} ‡∏Ñ‡∏ô</small>
                    </div>
                    <div>
                        <button onclick="viewDetails('${user.name}')" style="background:var(--navy-blue); color:white; border-radius:8px; font-size:0.8rem; padding: 8px;">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π</button>
                        <button onclick="deleteUser('${user.name}')" class="admin-del-btn">‡∏•‡∏ö User</button>
                    </div>
                `;
                listDiv.appendChild(card);
            });
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö User ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function deleteUser(userName) {
        if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á "${userName}" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
            db.ref('users/' + userName).remove()
            .then(() => alert("‡∏•‡∏ö User ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß"));
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô
    function viewDetails(userName) {
        db.ref('users/' + userName).once('value', (snapshot) => {
            const user = snapshot.val();
            if(!user || !user.seniors) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            
            document.getElementById('admin-view-title').innerText = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á " + userName;
            const contentDiv = document.getElementById('admin-view-content');
            contentDiv.innerHTML = "";

            user.seniors.forEach((s, i) => {
                const item = document.createElement('div');
                item.style.cssText = "border-bottom:1px solid #eee; padding:10px 0; position:relative;";
                item.innerHTML = `
                    <b>‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${i+1}: ${s.name} (CE${s.batch})</b><br>
                    <small>‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${s.phone} | ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${s.work}</small><br>
                    <small style="color:blue">‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô: ${s.intern}</small>
                    <button onclick="deleteSeniorRow('${userName}', ${i})" style="position:absolute; right:0; top:10px; background:red; color:white; border-radius:5px; font-size:10px; padding:3px 8px;">‡∏•‡∏ö‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ</button>
                `;
                contentDiv.appendChild(item);
            });
            document.getElementById('adminDetailModal').style.display = 'flex';
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function deleteSeniorRow(userName, index) {
        if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
            db.ref('users/' + userName).once('value', (snapshot) => {
                const user = snapshot.val();
                let seniors = user.seniors;
                seniors.splice(index, 1); // ‡∏•‡∏ö‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å
                
                db.ref('users/' + userName).update({
                    seniors: seniors,
                    count: seniors.length
                }).then(() => {
                    alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                    closeAdminModal(); // ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                });
            });
        }
    }
</script>
</body>
</html>
